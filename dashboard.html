<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADB-Insight Dashboard - Real-time Android Metrics</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .status-bar {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .status-item {
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 20px;
            color: white;
            font-size: 0.9em;
            backdrop-filter: blur(10px);
        }

        .status-item.online {
            background: rgba(76, 175, 80, 0.3);
        }

        .status-item.offline {
            background: rgba(244, 67, 54, 0.3);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        .card-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 15px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: 500;
            color: #666;
        }

        .info-value {
            font-weight: 600;
            color: #667eea;
            text-align: right;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin-top: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
        }

        .temperature {
            display: inline-block;
            padding: 8px 12px;
            margin: 5px;
            border-radius: 6px;
            font-weight: 500;
            font-size: 0.9em;
        }

        .temp-cold {
            background: #b3e5fc;
            color: #0277bd;
        }

        .temp-warm {
            background: #ffe0b2;
            color: #e65100;
        }

        .temp-hot {
            background: #ffccbc;
            color: #d84315;
        }

        .cpu-core {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            padding: 8px;
            margin: 5px;
            background: #f5f5f5;
            border-radius: 8px;
            min-width: 60px;
        }

        .cpu-core-label {
            font-size: 0.75em;
            color: #999;
            font-weight: 600;
        }

        .cpu-core-value {
            font-size: 1.1em;
            font-weight: 600;
            color: #667eea;
        }

        .cpu-cores-container {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: 600;
            margin: 3px 3px 3px 0;
        }

        .badge-primary {
            background: #e3f2fd;
            color: #1976d2;
        }

        .badge-success {
            background: #e8f5e9;
            color: #388e3c;
        }

        .badge-warning {
            background: #fff3e0;
            color: #f57c00;
        }

        .chart-container {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #eee;
        }

        .metric-large {
            font-size: 2.5em;
            font-weight: 700;
            color: #667eea;
            text-align: center;
            margin: 20px 0;
        }

        .metric-label {
            text-align: center;
            color: #999;
            font-size: 0.9em;
        }

        .timestamp {
            font-size: 0.85em;
            color: #999;
            text-align: right;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }

        .update-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4caf50;
            margin-left: 8px;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 10px;
            border-left: 4px solid #c62828;
        }

        .success-message {
            background: #e8f5e9;
            color: #2e7d32;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 10px;
            border-left: 4px solid #2e7d32;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        button:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 3px solid rgba(102, 126, 234, 0.3);
            border-radius: 50%;
            border-top-color: #667eea;
            animation: spin 0.8s linear infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .websocket-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
            padding: 8px 12px;
            background: rgba(255,255,255,0.2);
            border-radius: 20px;
            color: white;
        }

        .ws-status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #4caf50;
        }

        .ws-status-dot.disconnected {
            background: #f44336;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }

            header h1 {
                font-size: 1.8em;
            }

            .status-bar {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üì± ADB-Insight Dashboard</h1>
            <div class="status-bar">
                <div class="status-item" id="apiStatus">
                    <span class="spinner"></span> Connecting...
                </div>
                <div class="websocket-indicator">
                    <div class="ws-status-dot" id="wsMetricsStatus"></div>
                    <span>WS Metrics: Connecting...</span>
                </div>
                <div class="websocket-indicator">
                    <div class="ws-status-dot" id="wsCpuStatus"></div>
                    <span>WS CPU: Connecting...</span>
                </div>
            </div>
        </header>

        <div class="button-group">
            <button onclick="refreshAll()">üîÑ Refresh Now</button>
            <button onclick="toggleAutoRefresh()">‚è∏Ô∏è Auto-Refresh: ON</button>
        </div>

        <div id="messages"></div>

        <div class="grid">
            <!-- Device Card -->
            <div class="card">
                <div class="card-title">üì¶ Device Information</div>
                <div class="info-row">
                    <span class="info-label">Model</span>
                    <span class="info-value" id="deviceModel">‚Äî</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Manufacturer</span>
                    <span class="info-value" id="deviceManufacturer">‚Äî</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Android Version</span>
                    <span class="info-value" id="deviceVersion">‚Äî</span>
                </div>
                <div class="info-row">
                    <span class="info-label">SDK Level</span>
                    <span class="info-value" id="deviceSdk">‚Äî</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Hardware</span>
                    <span class="info-value" id="deviceHardware">‚Äî</span>
                </div>
                <div class="timestamp" id="deviceTimestamp"></div>
            </div>

            <!-- CPU Card -->
            <div class="card">
                <div class="card-title">‚öôÔ∏è CPU Information</div>
                <div class="info-row">
                    <span class="info-label">Cores</span>
                    <span class="info-value" id="cpuCores">‚Äî</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Architecture</span>
                    <span class="info-value" id="cpuArch">‚Äî</span>
                </div>
                <div class="info-row">
                    <span class="info-label">ABI</span>
                    <span class="info-value" id="cpuAbi">‚Äî</span>
                </div>
                <div class="info-row">
                    <span class="info-label">ABI List</span>
                    <span class="info-value" id="cpuAbiList" style="text-align: right; flex-direction: column;">‚Äî</span>
                </div>
                <div class="timestamp" id="cpuTimestamp"></div>
            </div>

            <!-- CPU Frequency Card -->
            <div class="card">
                <div class="card-title">‚ö° CPU Frequency
                    <span class="update-indicator" id="cpuFreqIndicator"></span>
                </div>
                <div class="info-row">
                    <span class="info-label">Min Frequency</span>
                    <span class="info-value" id="cpuFreqMin">‚Äî</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Max Frequency</span>
                    <span class="info-value" id="cpuFreqMax">‚Äî</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Average Frequency</span>
                    <span class="info-value" id="cpuFreqAvg">‚Äî</span>
                </div>
                <div class="chart-container">
                    <div class="metric-label">Per-Core Frequencies (MHz)</div>
                    <div class="cpu-cores-container" id="cpuCoresFreq"></div>
                </div>
                <div class="timestamp" id="cpuFreqTimestamp"></div>
            </div>

            <!-- Memory Card -->
            <div class="card">
                <div class="card-title">üíæ Memory Status
                    <span class="update-indicator"></span>
                </div>
                <div style="margin: 20px 0;">
                    <div class="metric-large" id="memoryPercent">‚Äî%</div>
                    <div class="metric-label">Usage</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="memoryProgressFill" style="width: 0%"></div>
                    </div>
                </div>
                <div class="info-row">
                    <span class="info-label">Total</span>
                    <span class="info-value" id="memoryTotal">‚Äî</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Used</span>
                    <span class="info-value" id="memoryUsed">‚Äî</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Available</span>
                    <span class="info-value" id="memoryAvailable">‚Äî</span>
                </div>
                <div class="timestamp" id="memoryTimestamp"></div>
            </div>

            <!-- Storage Card -->
            <div class="card">
                <div class="card-title">üíø Storage Status
                    <span class="update-indicator"></span>
                </div>
                <div style="margin: 20px 0;">
                    <div class="metric-large" id="storagePercent">‚Äî%</div>
                    <div class="metric-label">Usage</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="storageProgressFill" style="width: 0%"></div>
                    </div>
                </div>
                <div class="info-row">
                    <span class="info-label">Total</span>
                    <span class="info-value" id="storageTotal">‚Äî</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Used</span>
                    <span class="info-value" id="storageUsed">‚Äî</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Free</span>
                    <span class="info-value" id="storageFree">‚Äî</span>
                </div>
                <div class="timestamp" id="storageTimestamp"></div>
            </div>

            <!-- Battery Card -->
            <div class="card">
                <div class="card-title">üîã Battery Status
                    <span class="update-indicator"></span>
                </div>
                <div style="margin: 20px 0;">
                    <div class="metric-large" id="batteryPercent">‚Äî%</div>
                    <div class="metric-label">Battery Level</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="batteryProgressFill" style="width: 0%; background: linear-gradient(90deg, #4caf50, #8bc34a);"></div>
                    </div>
                </div>
                <div class="info-row">
                    <span class="info-label">Temperature</span>
                    <span class="info-value" id="batteryTemp">‚Äî</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Voltage</span>
                    <span class="info-value" id="batteryVoltage">‚Äî</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Technology</span>
                    <span class="info-value" id="batteryTech">‚Äî</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Charging Status</span>
                    <span class="info-value" id="batteryCharging">‚Äî</span>
                </div>
                <div class="timestamp" id="batteryTimestamp"></div>
            </div>

            <!-- Thermal Card -->
            <div class="card">
                <div class="card-title">üå°Ô∏è Thermal Information
                    <span class="update-indicator"></span>
                </div>
                <div class="info-row">
                    <span class="info-label">Max Temperature</span>
                    <span class="info-value" id="thermalMax">‚Äî</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Min Temperature</span>
                    <span class="info-value" id="thermalMin">‚Äî</span>
                </div>
                <div class="chart-container">
                    <div class="metric-label">Sensor Temperatures</div>
                    <div id="thermalSensors"></div>
                </div>
                <div class="timestamp" id="thermalTimestamp"></div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://10.10.10.48:8000';
        let autoRefreshInterval = null;
        let autoRefreshEnabled = true;
        let lastUpdateTime = {};

        // Show message
        function showMessage(message, type = 'info') {
            const messagesDiv = document.getElementById('messages');
            const messageEl = document.createElement('div');
            messageEl.className = `${type}-message`;
            messageEl.textContent = message;
            messagesDiv.innerHTML = '';
            messagesDiv.appendChild(messageEl);
            setTimeout(() => messageEl.remove(), 5000);
        }

        // Update API status
        function updateApiStatus(status) {
            const statusEl = document.getElementById('apiStatus');
            if (status === 'healthy') {
                statusEl.className = 'status-item online';
                statusEl.innerHTML = '‚úÖ API Connected';
            } else {
                statusEl.className = 'status-item offline';
                statusEl.innerHTML = '‚ùå API Disconnected';
            }
        }

        // Fetch and display device info
        async function fetchDevice() {
            try {
                const response = await fetch(`${API_URL}/device`);
                const data = await response.json();
                document.getElementById('deviceModel').textContent = data.model;
                document.getElementById('deviceManufacturer').textContent = data.manufacturer;
                document.getElementById('deviceVersion').textContent = data.android_version;
                document.getElementById('deviceSdk').textContent = data.sdk;
                document.getElementById('deviceHardware').textContent = data.hardware;
                lastUpdateTime.device = new Date().toLocaleTimeString();
                document.getElementById('deviceTimestamp').textContent = `Last updated: ${lastUpdateTime.device}`;
            } catch (e) {
                console.error('Device fetch error:', e);
            }
        }

        // Fetch and display CPU info
        async function fetchCPU() {
            try {
                const response = await fetch(`${API_URL}/cpu`);
                const data = await response.json();
                document.getElementById('cpuCores').textContent = data.cores;
                document.getElementById('cpuArch').textContent = data.arch;
                document.getElementById('cpuAbi').textContent = data.abi;
                lastUpdateTime.cpu = new Date().toLocaleTimeString();
                document.getElementById('cpuTimestamp').textContent = `Last updated: ${lastUpdateTime.cpu}`;
            } catch (e) {
                console.error('CPU fetch error:', e);
            }
        }

        // Fetch and display CPU frequency
        async function fetchCPUFrequency() {
            try {
                const response = await fetch(`${API_URL}/cpu/frequency`);
                const data = await response.json();
                
                document.getElementById('cpuFreqMin').textContent = `${data.min_mhz.toFixed(2)} MHz`;
                document.getElementById('cpuFreqMax').textContent = `${data.max_mhz.toFixed(2)} MHz`;
                document.getElementById('cpuFreqAvg').textContent = `${data.avg_mhz.toFixed(2)} MHz`;
                
                // Display per-core frequencies
                const coresContainer = document.getElementById('cpuCoresFreq');
                coresContainer.innerHTML = '';
                if (data.per_core) {
                    Object.entries(data.per_core).forEach(([core, freq]) => {
                        const mhz = (freq / 1000).toFixed(0);
                        const coreEl = document.createElement('div');
                        coreEl.className = 'cpu-core';
                        coreEl.innerHTML = `<div class="cpu-core-label">${core}</div><div class="cpu-core-value">${mhz}</div>`;
                        coresContainer.appendChild(coreEl);
                    });
                }
                
                lastUpdateTime.cpuFreq = new Date().toLocaleTimeString();
                document.getElementById('cpuFreqTimestamp').textContent = `Last updated: ${lastUpdateTime.cpuFreq}`;
            } catch (e) {
                console.error('CPU Frequency fetch error:', e);
            }
        }

        // Fetch and display memory
        async function fetchMemory() {
            try {
                const response = await fetch(`${API_URL}/memory`);
                const data = await response.json();
                
                document.getElementById('memoryPercent').textContent = `${data.usage_percent.toFixed(1)}%`;
                document.getElementById('memoryProgressFill').style.width = `${Math.min(data.usage_percent, 100)}%`;
                document.getElementById('memoryTotal').textContent = `${data.total_mb.toFixed(2)} MB`;
                document.getElementById('memoryUsed').textContent = `${data.used_mb.toFixed(2)} MB`;
                document.getElementById('memoryAvailable').textContent = `${data.available_mb.toFixed(2)} MB`;
                
                lastUpdateTime.memory = new Date().toLocaleTimeString();
                document.getElementById('memoryTimestamp').textContent = `Last updated: ${lastUpdateTime.memory}`;
            } catch (e) {
                console.error('Memory fetch error:', e);
            }
        }

        // Fetch and display storage
        async function fetchStorage() {
            try {
                const response = await fetch(`${API_URL}/storage`);
                const data = await response.json();
                
                document.getElementById('storagePercent').textContent = `${data.usage_percent.toFixed(1)}%`;
                document.getElementById('storageProgressFill').style.width = `${Math.min(data.usage_percent, 100)}%`;
                document.getElementById('storageTotal').textContent = `${data.total_gb.toFixed(2)} GB`;
                document.getElementById('storageUsed').textContent = `${data.used_gb.toFixed(2)} GB`;
                document.getElementById('storageFree').textContent = `${data.free_gb.toFixed(2)} GB`;
                
                lastUpdateTime.storage = new Date().toLocaleTimeString();
                document.getElementById('storageTimestamp').textContent = `Last updated: ${lastUpdateTime.storage}`;
            } catch (e) {
                console.error('Storage fetch error:', e);
            }
        }

        // Fetch and display battery
        async function fetchBattery() {
            try {
                const response = await fetch(`${API_URL}/battery`);
                const data = await response.json();
                
                document.getElementById('batteryPercent').textContent = `${data.level}%`;
                document.getElementById('batteryProgressFill').style.width = `${data.level}%`;
                document.getElementById('batteryTemp').textContent = `${data.temperature_c.toFixed(1)}¬∞C`;
                document.getElementById('batteryVoltage').textContent = `${data.voltage_mv} mV`;
                document.getElementById('batteryTech').textContent = data.technology;
                document.getElementById('batteryCharging').textContent = data.is_charging ? 'üîå Charging' : 'üîã Discharging';
                
                lastUpdateTime.battery = new Date().toLocaleTimeString();
                document.getElementById('batteryTimestamp').textContent = `Last updated: ${lastUpdateTime.battery}`;
            } catch (e) {
                console.error('Battery fetch error:', e);
            }
        }

        // Fetch and display thermal
        async function fetchThermal() {
            try {
                const response = await fetch(`${API_URL}/thermal`);
                const data = await response.json();
                
                document.getElementById('thermalMax').textContent = `${data.max_temp_c.toFixed(1)}¬∞C`;
                document.getElementById('thermalMin').textContent = `${data.min_temp_c.toFixed(1)}¬∞C`;
                
                // Display sensor temperatures
                const sensorsContainer = document.getElementById('thermalSensors');
                sensorsContainer.innerHTML = '';
                if (data.temperatures) {
                    Object.entries(data.temperatures).forEach(([sensor, temp]) => {
                        let tempClass = 'temp-cold';
                        if (temp >= 40) tempClass = 'temp-hot';
                        else if (temp >= 30) tempClass = 'temp-warm';
                        
                        const sensorEl = document.createElement('span');
                        sensorEl.className = `temperature ${tempClass}`;
                        sensorEl.textContent = `${sensor}: ${temp.toFixed(1)}¬∞C`;
                        sensorsContainer.appendChild(sensorEl);
                    });
                }
                
                lastUpdateTime.thermal = new Date().toLocaleTimeString();
                document.getElementById('thermalTimestamp').textContent = `Last updated: ${lastUpdateTime.thermal}`;
            } catch (e) {
                console.error('Thermal fetch error:', e);
            }
        }

        // Check API health
        async function checkHealth() {
            try {
                const response = await fetch(`${API_URL}/health`);
                const data = await response.json();
                updateApiStatus(data.status);
            } catch (e) {
                updateApiStatus('unhealthy');
                console.error('Health check error:', e);
            }
        }

        // Connect to WebSocket for metrics
        function connectMetricsWebSocket() {
            const wsUri = `ws://10.10.10.48:8000/ws/metrics`;
            try {
                const ws = new WebSocket(wsUri);
                
                ws.onopen = () => {
                    console.log('Metrics WebSocket connected');
                    document.getElementById('wsMetricsStatus').classList.remove('disconnected');
                };
                
                ws.onmessage = (event) => {
                    try {
                        const data = JSON.parse(event.data);
                        // Update metrics from WebSocket
                        if (data.battery) {
                            document.getElementById('batteryPercent').textContent = `${data.battery.level}%`;
                            document.getElementById('batteryProgressFill').style.width = `${data.battery.level}%`;
                            document.getElementById('batteryTemp').textContent = `${data.battery.temperature_c.toFixed(1)}¬∞C`;
                        }
                        if (data.memory) {
                            document.getElementById('memoryPercent').textContent = `${data.memory.usage_percent.toFixed(1)}%`;
                            document.getElementById('memoryProgressFill').style.width = `${Math.min(data.memory.usage_percent, 100)}%`;
                        }
                        if (data.storage) {
                            document.getElementById('storagePercent').textContent = `${data.storage.usage_percent.toFixed(1)}%`;
                            document.getElementById('storageProgressFill').style.width = `${Math.min(data.storage.usage_percent, 100)}%`;
                        }
                    } catch (e) {
                        console.error('Metrics WebSocket parse error:', e);
                    }
                };
                
                ws.onerror = (error) => {
                    console.error('Metrics WebSocket error:', error);
                    document.getElementById('wsMetricsStatus').classList.add('disconnected');
                };
                
                ws.onclose = () => {
                    console.log('Metrics WebSocket closed, reconnecting in 3s...');
                    document.getElementById('wsMetricsStatus').classList.add('disconnected');
                    setTimeout(connectMetricsWebSocket, 3000);
                };
            } catch (e) {
                console.error('WebSocket connection error:', e);
            }
        }

        // Connect to WebSocket for CPU
        function connectCPUWebSocket() {
            const wsUri = `ws://10.10.10.48:8000/ws/cpu`;
            try {
                const ws = new WebSocket(wsUri);
                
                ws.onopen = () => {
                    console.log('CPU WebSocket connected');
                    document.getElementById('wsCpuStatus').classList.remove('disconnected');
                };
                
                ws.onmessage = (event) => {
                    try {
                        const data = JSON.parse(event.data);
                        // Update CPU frequency from WebSocket
                        if (data.per_core) {
                            const coresContainer = document.getElementById('cpuCoresFreq');
                            coresContainer.innerHTML = '';
                            Object.entries(data.per_core).forEach(([core, freq]) => {
                                const mhz = (freq / 1000).toFixed(0);
                                const coreEl = document.createElement('div');
                                coreEl.className = 'cpu-core';
                                coreEl.innerHTML = `<div class="cpu-core-label">${core}</div><div class="cpu-core-value">${mhz}</div>`;
                                coresContainer.appendChild(coreEl);
                            });
                        }
                        if (data.min_mhz) {
                            document.getElementById('cpuFreqMin').textContent = `${data.min_mhz.toFixed(2)} MHz`;
                        }
                        if (data.max_mhz) {
                            document.getElementById('cpuFreqMax').textContent = `${data.max_mhz.toFixed(2)} MHz`;
                        }
                        if (data.avg_mhz) {
                            document.getElementById('cpuFreqAvg').textContent = `${data.avg_mhz.toFixed(2)} MHz`;
                        }
                    } catch (e) {
                        console.error('CPU WebSocket parse error:', e);
                    }
                };
                
                ws.onerror = (error) => {
                    console.error('CPU WebSocket error:', error);
                    document.getElementById('wsCpuStatus').classList.add('disconnected');
                };
                
                ws.onclose = () => {
                    console.log('CPU WebSocket closed, reconnecting in 3s...');
                    document.getElementById('wsCpuStatus').classList.add('disconnected');
                    setTimeout(connectCPUWebSocket, 3000);
                };
            } catch (e) {
                console.error('WebSocket connection error:', e);
            }
        }

        // Refresh all data
        function refreshAll() {
            checkHealth();
            fetchDevice();
            fetchCPU();
            fetchCPUFrequency();
            fetchMemory();
            fetchStorage();
            fetchBattery();
            fetchThermal();
        }

        // Toggle auto-refresh
        function toggleAutoRefresh() {
            autoRefreshEnabled = !autoRefreshEnabled;
            const button = event.target;
            
            if (autoRefreshEnabled) {
                button.textContent = '‚è∏Ô∏è Auto-Refresh: ON';
                autoRefreshInterval = setInterval(refreshAll, 5000);
            } else {
                button.textContent = '‚ñ∂Ô∏è Auto-Refresh: OFF';
                clearInterval(autoRefreshInterval);
            }
        }

        // Initialize
        function init() {
            // Initial fetch
            refreshAll();
            
            // Check health every 10 seconds
            setInterval(checkHealth, 10000);
            
            // Auto-refresh every 5 seconds
            autoRefreshInterval = setInterval(refreshAll, 5000);
            
            // Connect WebSockets
            connectMetricsWebSocket();
            connectCPUWebSocket();
            
            showMessage('‚úÖ Dashboard initialized and connecting to API', 'success');
        }

        // Start when page loads
        window.addEventListener('load', init);
    </script>
</body>
</html>
